!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(n=n||self).ErrorWatch=e()}(this,function(){"use strict";var l=!0,t=!0,a=11,m="ErrorWatch.report";function b(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function g(n){return void 0===n}var h="?",i={};function k(n){if("string"!=typeof n)return[];if(!b(i,n)){var e="",r="";try{r=window.document.domain}catch(n){}var t=/(.*)\:\/\/([^:\/]+)([:\d]*)\/{0,1}([\s\S]*)/.exec(n);t&&t[2]===r&&(e=""),i[n]=e?e.split("\n"):[]}return i[n]}function y(n,e){var r,t=/function ([^(]*)\(([^)]*)\)/,i=/['"]?([0-9A-Za-z$_]+)['"]?\s*[:=]\s*(function|eval|new Function)/,l=k(n),u="";if(!l.length)return h;for(var c=0;c<10;++c)if(!g(u=l[e-c]+u)){if(r=i.exec(u))return r[1];if(r=t.exec(u))return r[1]}return h}function S(n,e){var r=k(n);if(!r.length)return null;var t=[],i=Math.floor(a/2),l=i+a%2,u=Math.max(0,e-i-1),c=Math.min(r.length,e+l-1);--e;for(var o=u;o<c;++o)g(r[o])||t.push(r[o]);return 0<t.length?t:null}function d(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#]/g,"\\$&")}function E(n){return d(n).replace("<","(?:<|&lt;)").replace(">","(?:>|&gt;)").replace("&","(?:&|&amp;)").replace('"','(?:"|&quot;)').replace(/\s+/g,"\\s+")}function $(n,e){for(var r,t,i=0,l=e.length;i<l;++i)if((r=k(e[i])).length&&(r=r.join("\n"),t=n.exec(r)))return{url:e[i],line:r.substring(0,t.index).split("\n").length,column:t.index-r.lastIndexOf("\n",t.index)-1};return null}function v(n,e,r){var t,i=k(e),l=new RegExp("\\b"+d(n)+"\\b");return--r,i&&i.length>r&&(t=l.exec(i[r]))?t.index:null}function p(n){if(g(window&&window.document))return null;for(var e,r,t,i,l=[window.location.href],u=window.document.getElementsByTagName("script"),c=""+n,o=0;o<u.length;++o){var a=u[o];a.src&&l.push(a.src)}if(t=/^function(?:\s+([\w$]+))?\s*\(([\w\s,]*)\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/.exec(c)){var s=t[1]?"\\s+"+t[1]:"",f=t[2].split(",").join("\\s*,\\s*");e=d(t[3]).replace(/;$/,";?"),r=new RegExp("function"+s+"\\s*\\(\\s*"+f+"\\s*\\)\\s*{\\s*"+e+"\\s*}")}else r=new RegExp(d(c).replace(/\s+/g,"\\s+"));if(i=$(r,l))return i;if(t=/^function on([\w$]+)\s*\(event\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/.exec(c)){var m=t[1];if(e=E(t[2]),i=$(r=new RegExp("on"+m+"=[\\'\"]\\s*"+e+"\\s*[\\'\"]","i"),l[0]))return i;if(i=$(r=new RegExp(e),l))return i}return null}function u(n){if(!n.stack)return null;for(var e,r,t,i=/^\s*at (.*?) ?\(((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,l=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|\[native).*?|[^@]*bundle)(?::(\d+))?(?::(\d+))?\s*$/i,u=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,c=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,o=/\((\S*)(?::(\d+))(?::(\d+))\)/,a=n.stack.split("\n"),s=/^(.*) is undefined$/.exec(n.message),f=[],m=0,d=a.length;m<d;++m){if(r=i.exec(a[m])){var p=r[2]&&0===r[2].indexOf("native");r[2]&&0===r[2].indexOf("eval")&&(e=o.exec(r[2]))&&(r[2]=e[1],r[3]=e[2],r[4]=e[3]),t={url:p?null:r[2],func:r[1]||h,args:p?[r[2]]:[],line:r[3]?+r[3]:null,column:r[4]?+r[4]:null}}else if(r=u.exec(a[m]))t={url:r[2],func:r[1]||h,args:[],line:+r[3],column:r[4]?+r[4]:null};else{if(!(r=l.exec(a[m])))continue;r[3]&&-1<r[3].indexOf(" > eval")&&(e=c.exec(r[3]))?(r[3]=e[1],r[4]=e[2],r[5]=null):0!==m||r[5]||g(n.columnNumber)||(f[0].column=n.columnNumber+1),t={url:r[3],func:r[1]||h,args:r[2]?r[2].split(","):[],line:r[4]?+r[4]:null,column:r[5]?+r[5]:null}}!t.func&&t.line&&(t.func=y(t.url,t.line)),t.context=t.line?S(t.url,t.line):null,f.push(t)}return f.length?(f[0]&&f[0].line&&!f[0].column&&s&&(f[0].column=v(s[1],f[0].url,f[0].line)),{mode:"stack",name:n.name,message:n.message,stack:f}):null}function w(n,e,r,t){var i={url:e,line:r};if(i.url&&i.line){n.incomplete=!1,i.func||(i.func=y(i.url,i.line)),i.context||(i.context=S(i.url,i.line));var l=/ '([^']+)' /.exec(t);if(l&&(i.column=v(l[1],i.url,i.line)),0<n.stack.length&&n.stack[0].url===i.url){if(n.stack[0].line===i.line)return!1;if(!n.stack[0].line&&n.stack[0].func===i.func)return n.stack[0].line=i.line,n.stack[0].context=i.context,!1}return n.stack.unshift(i),n.partial=!0}return!(n.incomplete=!0)}function x(n,e){for(var r,t,i,l=/function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,u=[],c={},o=!1,a=x.caller;a&&!o;a=a.caller)if(!(a===F||a&&a.__name__===m)){if(t={url:null,func:h,args:[],line:null,column:null},a.name?t.func=a.name:(r=l.exec(a.toString()))&&(t.func=r[1]),void 0===t.func)try{t.func=r.input.substring(0,r.input.indexOf("{"))}catch(n){}if(i=p(a)){t.url=i.url,t.line=i.line,t.func===h&&(t.func=y(t.url,t.line));var s=/ '([^']+)' /.exec(n.message||n.description);s&&(t.column=v(s[1],i.url,i.line))}c[""+a]?o=!0:c[""+a]=!0,u.push(t)}e&&u.splice(0,e);var f={mode:"callers",name:n.name,message:n.message,stack:u};return w(f,n.sourceURL||n.fileName,n.line||n.lineNumber,n.message||n.description),f}function F(n,e){var r=null;e=null==e?0:+e;try{if(r=function(n){var e=n.stacktrace;if(e){for(var r,t=/ line (\d+).*script (?:in )?(\S+)(?:: in function (\S+))?$/i,i=/ line (\d+), column (\d+)\s*(?:in (?:<anonymous function: ([^>]+)>|([^\)]+))\((.*)\))? in (.*):\s*$/i,l=e.split("\n"),u=[],c=0;c<l.length;c+=2){var o=null;if((r=t.exec(l[c]))?o={url:r[2],line:+r[1],column:null,func:r[3],args:[]}:(r=i.exec(l[c]))&&(o={url:r[6],line:+r[1],column:+r[2],func:r[3]||r[4],args:r[5]?r[5].split(","):[]}),o){if(!o.func&&o.line&&(o.func=y(o.url,o.line)),o.line)try{o.context=S(o.url,o.line)}catch(n){}o.context||(o.context=[l[c+1]]),u.push(o)}}return u.length?{mode:"stacktrace",name:n.name,message:n.message,stack:u}:null}}(n))return r}catch(n){}try{if(r=u(n))return r}catch(n){}try{if(r=function(n){var e=n.message.split("\n");if(e.length<4)return null;var r,t=/^\s*Line (\d+) of linked script ((?:file|https?|blob)\S+)(?:: in function (\S+))?\s*$/i,i=/^\s*Line (\d+) of inline#(\d+) script in ((?:file|https?|blob)\S+)(?:: in function (\S+))?\s*$/i,l=/^\s*Line (\d+) of function script\s*$/i,u=[],c=window&&window.document&&window.document.getElementsByTagName("script"),o=[];for(var a in c)b(c,a)&&!c[a].src&&o.push(c[a]);for(var s=2;s<e.length;s+=2){var f=null;if(r=t.exec(e[s]))f={url:r[2],func:r[3],args:[],line:+r[1],column:null};else if(r=i.exec(e[s])){f={url:r[3],func:r[4],args:[],line:+r[1],column:null};var m=+r[1],d=o[r[2]-1];if(d){var p=k(f.url);if(p){var g=(p=p.join("\n")).indexOf(d.innerText);0<=g&&(f.line=m+p.substring(0,g).split("\n").length)}}}else if(r=l.exec(e[s])){var h=window.location.href.replace(/#.*$/,""),v=$(new RegExp(E(e[s+1])),[h]);f={url:h,func:"",args:[],line:v?v.line:r[1],column:null}}if(f){f.func||(f.func=y(f.url,f.line));var w=S(f.url,f.line),x=w?w[Math.floor(w.length/2)]:null;w&&x.replace(/^\s*/,"")===e[s+1].replace(/^\s*/,"")?f.context=w:f.context=[e[s+1]],u.push(f)}}return u.length?{mode:"multiline",name:n.name,message:e[0],stack:u}:null}(n))return r}catch(n){}try{if(r=x(n,e+1))return r}catch(n){}return{name:n.name,message:n.message,mode:"failed"}}F.augmentStackTraceWithInitialElement=w,F.computeStackTraceFromStackProp=u,F.guessFunctionName=y,F.gatherContext=S,F.ofCaller=function(e){e=1+(null==e?0:+e);try{throw new Error}catch(n){return F(n,e+1)}},F.getSource=k;var c=!1,o=null;var s,r,f,j,T=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/,_=[],R=null,N=null;function L(n,e,r){var t=null;if(!e||l){for(var i in _)if(b(_,i))try{_[i](n,e,r)}catch(n){t=n}if(t)throw t}}function e(n,e,r,t,i){if(N)F.augmentStackTraceWithInitialElement(N,e,r,n),A();else if(i)L(F(i),!0,i);else{var l,u={url:e,line:r,column:t},c=n;if("[object String]"==={}.toString.call(n)){var o=n.match(T);o&&(l=o[1],c=o[2])}u.func=F.guessFunctionName(u.url,u.line),u.context=F.gatherContext(u.url,u.line),L({name:l,message:c,mode:"onerror",stack:[u]},!0,null)}return!!s&&s.apply(this,arguments)}function O(n){L(F(n.reason),!0,n.reason)}function A(){var n=N,e=R;R=N=null,L(n,!1,e)}function I(n){if(N){if(R===n)return;A()}var e=F(n);throw N=e,R=n,setTimeout(function(){R===n&&A()},e.incomplete?2e3:0),n}function W(n){return function(){try{return n.apply(this,arguments)}catch(n){throw I(n),n}}}I.subscribe=function(n){!function(){if(!0===r)return;s=window.onerror,window.onerror=e,function(r){!c&&t&&(o=r,window.addEventListener&&window.addEventListener("error",function(n){try{if(n.target!==window){var e={message:"".concat(n.target.localName," is load error"),mode:"resource",name:n.target.src||n.target.href||n.target.currentSrc,stack:null};r(e,!1,n)}}catch(n){throw n}},!0)),c=!0}(function(n,e,r){L(n,e,r)}),r=!0}(),function(){if(!0===j)return;f=window.onunhandledrejection,window.onunhandledrejection=O,j=!0}(),_.push(n)},I.unsubscribe=function(n){for(var e=_.length-1;0<=e;--e)_[e]===n&&_.splice(e,1);0===_.length&&(r&&(window.onerror=s,c&&t&&o&&(window.removeEventListener&&window.removeEventListener("error",o),o=null,c=!1),r=!1),j&&(window.onunhandledrejection=f,j=!1))},I.__name__=m;var C=[].slice;function n(n){var r=window[n];window[n]=function(){var n=C.call(arguments),e=n[0];return"function"==typeof e&&(n[0]=W(e)),r.apply?r.apply(this,n):r(n[0],n[1])}}var M,z=window.ErrorWatch;return M={noConflict:function(){return window.ErrorWatch=z,M},report:I,computeStackTrace:F,wrap:W,extendToAsynchronousCallbacks:function(){n("setTimeout"),n("setInterval")},makeError:function(){return thisIsAbug+""}}});
//# sourceMappingURL=errorWatch.min.js.map
